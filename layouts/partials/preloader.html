<div id="preloader-overlay">
  <div class="loader-content">
    
    <div class="flake-wrapper">
      <svg class="flake-svg flake-base" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 2v20M2 12h20M19.07 4.93L4.93 19.07M19.07 19.07L4.93 4.93M12 7l2-2M12 7l-2-2M12 17l2 2M12 17l-2 2M17 12l2 2M17 12l2-2M7 12l-2 2M7 12l-2-2"></path>
      </svg>

      <div id="flake-mask">
        <svg class="flake-svg flake-blue" viewBox="0 0 24 24" fill="none" stroke="#00d4ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 2v20M2 12h20M19.07 4.93L4.93 19.07M19.07 19.07L4.93 4.93M12 7l2-2M12 7l-2-2M12 17l2 2M12 17l-2 2M17 12l2 2M17 12l2-2M7 12l-2 2M7 12l-2-2"></path>
        </svg>
      </div>
    </div>

    <div id="loader-percent">0%</div>

    <div class="progress-track">
      <div id="progress-fill"></div>
    </div>

    <div class="loading-msg">LOADING YOUR EXPERIENCE</div>
  </div>
</div>

<style>
  /* On s'assure que rien ne dépasse */
  body { overflow: hidden; } 
  
  #preloader-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background-color: #1a1a1a;
    z-index: 9999999; /* Toujours au-dessus */
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s ease;
  }

  .loader-content {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* --- FLOCONS --- */
  .flake-wrapper {
    position: relative;
    width: 150px;
    height: 150px;
    margin-bottom: 20px;
  }

  .flake-svg {
    position: absolute;
    top: 0; left: 0;
    width: 150px;
    height: 150px;
  }

  .flake-base {
    opacity: 0.2; /* Le fond grisâtre */
    z-index: 1;
  }

  /* LE MASQUE MAGIQUE */
  #flake-mask {
    position: absolute;
    bottom: 0;      /* Collé en bas */
    left: 0;
    width: 100%;
    height: 0%;     /* Commence à 0% */
    overflow: hidden; /* Coupe ce qui dépasse */
    z-index: 2;
    /* Pas de transition CSS ici, le JS s'en occupe pour être fluide */
  }

  .flake-blue {
    position: absolute;
    bottom: 0;      /* Collé au bas du masque */
    left: 0;
    width: 150px;   /* TAILLE FIXE IMPORTANTE */
    height: 150px;  /* TAILLE FIXE IMPORTANTE */
    filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.8)); /* Effet Néon */
  }

  /* --- BARRE & TEXTE --- */
  #loader-percent {
    font-family: 'Rubik', sans-serif;
    font-size: 36px;
    font-weight: 700;
    color: #00d4ff;
    margin-bottom: 10px;
    text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
  }

  .progress-track {
    width: 250px;
    height: 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid rgba(0, 212, 255, 0.3);
  }

  #progress-fill {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #00a8cc, #00d4ff);
    box-shadow: 0 0 15px #00d4ff;
  }

  .loading-msg {
    margin-top: 15px;
    color: #888;
    font-family: sans-serif;
    font-size: 12px;
    letter-spacing: 2px;
  }
</style>

<script>
  (function() {
    // On encapsule pour ne pas polluer le reste du site
    var duration = 2000; // 2 secondes
    var intervalTime = 20; // mise à jour toutes les 20ms
    var steps = duration / intervalTime;
    var currentStep = 0;

    var percentDiv = document.getElementById('loader-percent');
    var barDiv = document.getElementById('progress-fill');
    var maskDiv = document.getElementById('flake-mask');
    var overlay = document.getElementById('preloader-overlay');

    var interval = setInterval(function() {
      currentStep++;
      var progress = (currentStep / steps) * 100;

      // Sécurité 100%
      if (progress > 100) progress = 100;

      // Mise à jour visuelle
      if (percentDiv) percentDiv.innerText = Math.floor(progress) + "%";
      if (barDiv) barDiv.style.width = progress + "%";
      if (maskDiv) maskDiv.style.height = progress + "%";

      // Fin du chargement
      if (currentStep >= steps) {
        clearInterval(interval);
        
        // On attend un tout petit peu (200ms) pour voir le 100%
        setTimeout(function() {
          if (overlay) {
            overlay.style.opacity = '0';
            setTimeout(function() {
              overlay.style.display = 'none';
              document.body.style.overflow = 'auto'; // Réactive le scroll
            }, 500);
          }
        }, 200);
      }
    }, intervalTime);
  })();
</script>